<!DOCTYPE html>
<html>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <head>
    <link rel="stylesheet" href="style.css">
  </head>
	<body>
    {{^session.valid}}
    <form action='/login' method='POST'>To log in, please use : admin/admin<br>
      User:<input type='text' name='USERNAME' placeholder='user name'><br>
      Password:<input type='password' name='PASSWORD' placeholder='password'><br>
      <input type='submit' name='SUBMIT' value='Login'>
    </form>
    {{/session.valid}}
    {{#session.valid}}
    <form action='/login' method='POST'>
      <input type='submit' name='DISCONNECT' value='Logout'>
    </form>
    {{/session.valid}}

    <dl>
			<dt>mac_address</dt>
      <dd>{{host.mac}}</dd>
			<dt>hostname</dt>
			<dd><input type="text" name="hostname" class="hostname" value="{{host.hostname}}"
           placeholder="hostname"><button type="button" name="save_hostname" 
           onclick="save('hostname')">Save</button>
			</dd>
			<dt>&nbsp</dt><dd>&nbsp</dd>
			<dt>IP address</dt>
			<dd><input type="text" pattern="\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" 
					 name="ip" class="ip" value="{{host.nwconfigured.address}}" placeholder="{{host.nwconfigured.address}}">
				  <button type="button" name="save_ip" onclick="save('ip')">Save</button>
					(0.0.0.0 for DHCP. Static boots quicker.)
		  </dd>
      <dt>Subnet mask</dt>
      <dd><input type="text" pattern="\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" name="subnet"
           class="subnet" value="{{host.nwconfigured.subnet}}" placeholder="{{host.nwconfigured.subnet}}">
          <button type="button" name="save_subnet" onclick="save('subnet')">Save</button>
      </dd>
      <dt>Gateway</dt>
      <dd><input type="text" pattern="\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" name="gateway" 
           class="gateway" value="{{host.nwconfigured.gateway}}" placeholder="{{host.nwconfigured.gateway}}">
          <button type="button" name="save_gateway" onclick="save('gateway')">Save</button>
      </dd>
      <dt>&nbsp</dt> <dd>&nbsp</dd>
      <dt>Static MQTT broker ip</dt>
      <dd><input type="text" pattern="\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}" name="brokerip" 
           class="brokerip" value="{{host.mqtt.broker.address}}" placeholder="{{host.mqtt.broker.address}}">
          <button type="button" name="save_brokerip" onclick="save('brokerip')">Save
          </button>(0.0.0.0 to use mDNS auto discovery)
      </dd>
      <dt>Static MQTT broker port</dt>
      <dd><input type="number" class="brokerport" value="{{host.mqtt.broker.port}}"></input>
          <button type="button" name="save_brokerport" onclick="save('brokerport')">Save</button>
      </dd>
      <dt>MQTT subscription prefix</dt>
      <dd><input type="text" name="subscribeprefix" class="subscribeprefix" 
           value="{{host.mqtt.subscribe_prefix}}" placeholder="some/subscribe/prefix/+">
          <button type="button" name="save_subscribeprefix" onclick="save('subscribeprefix')">
            Save
          </button>
      </dd>
      <dt>MQTT publish prefix</dt>
      <dd><input type="text" name="publishprefix" class="publishprefix"
           value="{{host.mqtt.publish_prefix}}" placeholder="some/publish/prefix">
          <button type="button" name="save_publishprefix" onclick="save('publishprefix')">
            Save
          </button>
      </dd>
      <dt>&nbsp</dt> <dd>&nbsp</dd>
      <dt>HTTP Firmware host</dt>
      <dd><input type="text" name="firmwarehost" class="firmwarehost"
           value="{{host.http.address}}" placeholder="http://your.firmware.host">
          <button type="button" name="save_firmwarehost" onclick="save('firmwarehost')">
            Save
          </button>
      </dd>
      <dt>HTTP Firmware directory</dt>
      <dd><input type="text" name="firmwaredirectory" class="firmwaredirectory"
           value="{{host.http.directory}}" placeholder="/some/directory/on/firmwarehost">
          <button type="button" name="save_firmwaredirectory" onclick="save('firmwaredirectory')">
            Save
          </button>
      </dd>
      <dt>HTTP Firmware port</dt>
      <dd><input type="number" class="firmwareport" value="{{host.http.port}}"></input>
          <button type="button" name="save_firmwareport" onclick="save('firmwareport')">
            Save
          </button>
      </dd>
      <dt>Config enable passphrase</dt>
      <dd><input type="text" name="enablepassphrase" class="enablepassphrase" 
           value="{{config.enablepassphrase}}" placeholder="Password_to_cahnge_config">
          <button type="button" name="save_enablepassphrase" onclick="save('enablepassphrase')">
            Save
          </button>
      </dd>
      <dt>Config enable IO pin</dt>
      <dd>
        <select class="enableiopin">
          {{#ui.iopin}}
          <option value="{{value}}" {{#selected}}selected{{/selected}}>
            {{value}}
          </option>
          {{/ui.iopin}}
        </select>
      </dd>
      <table>
        <tr class="">
          <th>index</th>
          <th>Topic</th>
          <th>type</th>
          <th>IO pin</th>
          <th>Default val</th>
          <th>Inverted</th>
          <th></th>
          <th></th>
        </tr>
        {{#io}}
        <tr class="device_{{index}}">
          <td>{{index}}</td>
          <td>
            {{host.mqtt.subscribe_prefix}}
            <input type="text" name="topic_{{index}}" class="device_{{index}}_topic" 
             value="{{topic}}" placeholder="some/topic">
          </td>
          <td>
            <select class="device_{{index}}_iotype">
              {{#ui.iotype}}
              <option value="{{value}}" {{#selected}}selected{{/selected}}>
                {{value}}
              </option>
              {{/ui.iotype}}
            </select>
          </td>
          <td>
            <select class="device_{{index}}_iopin">
              {{#ui.iopin}}
              <option value="{{value}}" {{#selected}}selected{{/selected}}>
                {{value}}
              </option>
              {{/ui.iopin}}
            </select>
          </td>
          <td>
            <input type="number" max="255" min="0" class="device_{{index}}_io_default"
             value="{{default}}"></input>
          </td>
          <td>
            <input type="checkbox" class="device_{{index}}_inverted" 
             {{#inverted}}checked{{/inverted}}></input>
          </td>
          <td>
            <button type="button" name="save_{{index}}" onclick="save('device_{{index}}')">
              Save
            </button>
          </td>
          <td>
            <button type="button" name="del_{{index}}" onclick="del('device_{{index}}')">
              Delete
            </button>
          </td>
        </tr>
        {{/io}}
      </table>
    </dl>
  </body>
  <script src="script.js"></script>
</html>
